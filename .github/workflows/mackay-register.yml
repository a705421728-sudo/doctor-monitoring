name: é¦¬å•å…’ç«¥é†«é™¢æ›è™Ÿç›£æ§

on:
  schedule:
    # æ¯10åˆ†é˜åŸ·è¡Œä¸€æ¬¡
    - cron: '*/10 * * * *'
  workflow_dispatch:  # å…è¨±æ‰‹å‹•è§¸ç™¼
  push:  # æ·»åŠ  push è§¸ç™¼ï¼Œæ–¹ä¾¿æ¸¬è©¦
    branches: [ main ]

jobs:
  mackay-register:
    runs-on: ubuntu-latest
    
    steps:
    - name: æª¢å‡ºä»£ç¢¼
      uses: actions/checkout@v3
    
    - name: è¨­ç½® Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: å®‰è£ä¾è³´
      run: |
        python -m pip install --upgrade pip
        pip install requests beautifulsoup4
    
    - name: èª¿è©¦ä¿¡æ¯
      run: |
        echo "=== GitHub Actions èª¿è©¦ä¿¡æ¯ ==="
        echo "åŸ·è¡Œæ™‚é–“: $(date)"
        echo "UTCæ™‚é–“: $(date -u)"
        echo "äº‹ä»¶é¡å‹: ${{ github.event_name }}"
        echo "æ˜¯å¦æ’ç¨‹è§¸ç™¼: ${{ github.event_name == 'schedule' }}"
        echo "å·¥ä½œæµç¨‹: ${{ github.workflow }}"
        echo "å€‰åº«: ${{ github.repository }}"
        echo "è§¸ç™¼å™¨: ${{ toJson(github.event) }}"
        echo "ç•¶å‰ç›®éŒ„: $(pwd)"
        echo "æ–‡ä»¶åˆ—è¡¨:"
        ls -la
    
    - name: åŸ·è¡Œæ›è™Ÿç›£æ§
      env:
        MACKAY_ID_NUMBER: ${{ secrets.MACKAY_ID_NUMBER }}
        MACKAY_BIRTHDAY: ${{ secrets.MACKAY_BIRTHDAY }}
        MACKAY_NOTIFICATION_EMAIL: ${{ secrets.MACKAY_NOTIFICATION_EMAIL }}
        SMTP_SERVER: ${{ secrets.SMTP_SERVER }}
        SMTP_PORT: ${{ secrets.SMTP_PORT }}
        SMTP_USERNAME: ${{ secrets.SMTP_USERNAME }}
        SMTP_PASSWORD: ${{ secrets.SMTP_PASSWORD }}
        SMTP_SENDER: ${{ secrets.SMTP_SENDER }}
        GITHUB_ACTIONS: 'true'
      run: |
        echo "ğŸ¥ é¦¬å•æ›è™Ÿç›£æ§å•Ÿå‹•"
        echo "é–‹å§‹åŸ·è¡Œæ™‚é–“: $(date)"
        python mackay_registrar.py
        echo "çµæŸåŸ·è¡Œæ™‚é–“: $(date)"
        echo "åŸ·è¡Œå®Œæˆ"
