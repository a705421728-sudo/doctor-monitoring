name: Mackay Children Hospital Auto Register

on:
  workflow_dispatch:  # æ‰‹å‹•è§¸ç™¼
  schedule:
    # æ”¹ç‚ºæ¯10åˆ†é˜åŸ·è¡Œä¸€æ¬¡ï¼ˆèˆ‡æ¦®ç¸½ä¸€è‡´ï¼Œç¢ºä¿å¯é ï¼‰
    - cron: '*/10 * * * *'

# æ·»åŠ ä¸¦è¡Œæ§åˆ¶ï¼Œé˜²æ­¢é‡ç–ŠåŸ·è¡Œ
concurrency:
  group: ${{ github.workflow }}
  cancel-in-progress: false

jobs:
  run_auto_register:
    runs-on: ubuntu-latest
    # ç¸®çŸ­è¶…æ™‚æ™‚é–“ï¼Œé¿å…é•·æ™‚é–“é‹è¡Œä½”ç”¨è³‡æº
    timeout-minutes: 5

    steps:
      # 1. ç²å–ä»£ç¢¼ï¼ˆä½¿ç”¨èˆ‡æ¦®ç¸½ç›¸åŒçš„ v3 ç‰ˆæœ¬ï¼‰
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. è¨­ç½®Pythonç’°å¢ƒ
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      # 3. å®‰è£ä¾è³´ï¼ˆç²¾ç°¡ç‰ˆï¼‰
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4

      # 4. åŸ·è¡Œæ›è™Ÿè…³æœ¬ï¼ˆæ ¸å¿ƒæ­¥é©Ÿï¼‰
      - name: Run Mackay auto register script
        env:
          # åƒ…æ³¨å…¥å¿…è¦è®Šæ•¸ï¼ˆç§»é™¤SMTPç›¸é—œï¼Œå…ˆç¢ºä¿æ ¸å¿ƒåŠŸèƒ½ï¼‰
          MACKAY_ID_NUMBER: ${{ secrets.MACKAY_ID_NUMBER }}
          MACKAY_BIRTHDAY: ${{ secrets.MACKAY_BIRTHDAY }}
          # éƒµä»¶é…ç½®æš«æ™‚ç§»é™¤ï¼Œå…ˆæ¸¬è©¦èª¿åº¦
        run: |
          echo "ğŸ¥ é¦¬å•æ›è™Ÿç›£æ§å•Ÿå‹•"
          echo "åŸ·è¡Œæ™‚é–“: $(date)"
          echo "äº‹ä»¶è§¸ç™¼: ${{ github.event_name }}"
          
          # åŸ·è¡Œä¸»ç¨‹åº
          python mackay_registrar.py
          
          echo "âœ… æœ¬æ¬¡åŸ·è¡Œå®Œæˆ"
