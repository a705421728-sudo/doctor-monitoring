name: é¦¬å•å…’ç«¥é†«é™¢æ›è™Ÿç›£æ§ (é•·æ•ˆç‰ˆ)

on:
  schedule:
    # æ¯å¤©æ¯ 3 å°æ™‚è§¸ç™¼ä¸€æ¬¡ (UTC æ™‚é–“ 0, 3, 6, 9, 12, 15, 18, 21)
    - cron: '5 */3 * * *'
  workflow_dispatch:
  push:
    branches: [ main ]

# ç¢ºä¿åŒä¸€æ™‚é–“åªæœ‰ä¸€å€‹ç›£æ§åœ¨è·‘
concurrency:
  group: mackay-monitor
  cancel-in-progress: true 

jobs:
  mackay-register:
    # å¿…é ˆæ˜¯å…¬é–‹ Repository æ‰èƒ½äº«å—ç„¡é™åˆ¶çš„å…è²»é¡åº¦
    runs-on: ubuntu-latest
    timeout-minutes: 200 # è¨­å®šç¨å¾®å¤§æ–¼ 180 åˆ†é˜ä½œç‚ºä¿éšª
    
    steps:
    - name: æª¢å‡ºä»£ç¢¼
      uses: actions/checkout@v3
    
    - name: è¨­ç½® Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: å®‰è£ä¾è³´
      run: |
        python -m pip install --upgrade pip
        pip install requests beautifulsoup4
    
    - name: åŸ·è¡Œæ›è™Ÿç›£æ§
      env:
        MACKAY_ID_NUMBER: ${{ secrets.MACKAY_ID_NUMBER }}
        MACKAY_BIRTHDAY: ${{ secrets.MACKAY_BIRTHDAY }}
        MACKAY_NOTIFICATION_EMAIL: ${{ secrets.MACKAY_NOTIFICATION_EMAIL }}
        SMTP_SERVER: ${{ secrets.SMTP_SERVER }}
        SMTP_PORT: ${{ secrets.SMTP_PORT }}
        SMTP_USERNAME: ${{ secrets.SMTP_USERNAME }}
        SMTP_PASSWORD: ${{ secrets.SMTP_PASSWORD }}
        SMTP_SENDER: ${{ secrets.SMTP_SENDER }}
      run: |
        echo "ğŸ¥3å°æ™‚é€£çºŒç›£æ§å•Ÿå‹•"
        python mackay_registrar.py
